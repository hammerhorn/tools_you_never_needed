#!/usr/bin/env python3
#coding=utf8
"""
translate the Roman alphabet into, e.g.,
radiophonic words, morse code, braille, etc....
"""
import time
import misc
from soxmusic import Pitch, Note

def convert_buffer(txt_buffer, name_of_code):
    """
    converts a whole string using the selected code
    """
    out_str_list = []

    # maybe this is kind of a mess to make a new dict each time
    for char in txt_buffer:
        letter - Letter(char)
    
        letter_versions = {
            'binary': letter.binary,
            'morse': letter.morse,
            'braille': letter.braille,
            'nato': letter.radio_name
        }
        out_str_list.extend([letter_versions[name_of_code], ' '])
    return ''.join(out_str_list)



class Letter():
    """
    convert between different forms of Roman-alphabet letters
    """
    mora = 0.048
    wpm = 1.2 / mora
    hertz = 1000

    morse_dict = {
        '1':'.----',
        '2':'..---',
        '3':'...--',
        '4':'....-',
        '5':'.....',
        '6':'-....',
        '7':'--...',
        '8':'---..',
        '9':'----.',
        '0':'-----',
        'A':'.-',
        'B':'-...',
        'C':'-.-.',
        'D':'-..',
        'E':'.',
        'F':'..-.',
        'G':'--.',
        'H':'....',
        'I':'..',
        'J':'.---',
        'K':'-.-',
        'L':'.-..',
        'M':'--',
        'N':'-.',
        'O':'---',
        'P':'.--.',
        'Q':'--.-',
        'R':'.-.',
        'S':'...',
        'T':'-',
        'U':'..-',
        'V':'...-',
        'W':'.--',
        'X':'-..-',
        'Y':'-.--',
        'Z':'--..',
        ' ':'/', '.':'.-.-.-'}

    radio_dict = {
        'A':'Alfa',
        'B':'Bravo',
        'C':'Charlie',
        'D':'Delta',
        'E':'Echo',
        'F':'Foxtrot',
        'G':'Golf',
        'H':'Hotel',
        'I':'India',
        'J':'Juliett',
        'K':'Kilo',
        'L':'Lima',
        'M':'Mike',
        'N':'November',
        'O':'Oscar',
        'P':'Papa',
        'Q':'Quebec',
        'R':'Romeo',
        'S':'Sierra',
        'T':'Tango',
        'U':'Uniform',
        'V':'Victor',
        'W':'Whiskey',
        'X':'Xray',
        'Y':'Yankee',
        'Z':'Zulu', ' ': '', '.': 'stop'}


    braille_dict = {
        'A':'⠁',
        'B':'⠃',
        'C':'⠉',
        'D':'⠙',
        'E':'⠑',
        'F':'⠋',
        'G':'⠛',
        'H':'⠓',
        'I':'⠊',
        'J':'⠚',
        'K':'⠅',
        'L':'⠇',
        'M':'⠍',
        'N':'⠝',
        'O':'⠕',
        'P':'⠏',
        'Q':'⠟',
        'R':'⠗',
        'S':'⠎',
        'T':'⠞',
        'U':'⠥',
        'V':'⠧',
        'W':'⠺',
        'X':'⠭',
        'Y':'⠽',
        'Z':'⠵', ' ':' ', '.':'  '}

    def __init__(self, char):
        if char.isalpha():
            self.majuscule = char.upper()
            self.radio_name = self.__class__.radio_dict[self.majuscule].upper()
            self.braille = self.__class__.braille_dict[self.majuscule]
            self.morse = self.__class__.morse_dict[char.upper()]
        else:
            self.majuscule = char
            self.radio_name = char
            self.braille = char
            self.morse = char
        self.binary = f'{ord(char):b}'.zfill(8)

        #self.mora = 0.048
        #self.wpm = 1.2 / self.mora
        #self.hertz = 1000


    def __str__(self):
        return f'{self.radio_name} {self.braille} {self.morse}'

    def play_morse(self):
        """
        Play audible Morse code using cjh.music and sox.
        """
        for dot_or_dash in self.morse:
            if dot_or_dash == '.':
                Note(
                    Pitch(freq=self.__class__.hertz),
                    self.__class__.mora
                ).play()

            elif dot_or_dash == '-':
                Note(
                    Pitch(freq=self.__class__.hertz),
                    self.__class__.mora * 3
                ).play()

            elif dot_or_dash == ' ':
                time.sleep(7 * self.__class__.mora)

            time.sleep(self.__class__.mora)
        time.sleep(3 * self.__class__.mora)

    def radio_speak(self):
        """
        Audibly pronounce NATO phonetics using speech synthesis
        """
        spoken_forms = {
            #'F': 'fox trott',
            'J': 'Julie-et',
            'K': 'key-low',
            'L': 'Lee-ma',
            'O': 'Oska',
            'P': 'Pawpaw',
            'Q': 'Kebec'
            }
        misc.speak(spoken_forms.get(self.majuscule, self.radio_name))
